<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Budget Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>
</head>
<body>
    <div id="root"></div>

```
<script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { PlusCircle, Trash2, Edit3, MapPin, DollarSign, Euro, Download, Upload } = lucide;

    const TravelBudgetTracker = () => {
      // Load data from localStorage on component mount
      const [expenses, setExpenses] = useState(() => {
        try {
          const savedExpenses = localStorage.getItem('travelBudgetExpenses');
          return savedExpenses ? JSON.parse(savedExpenses) : [];
        } catch (error) {
          console.error('Error loading expenses from localStorage:', error);
          return [];
        }
      });

      const [budgets, setBudgets] = useState(() => {
        try {
          const savedBudgets = localStorage.getItem('travelBudgetBudgets');
          return savedBudgets ? JSON.parse(savedBudgets) : {
            Dan: {
              Food: 500,
              Transportation: 300,
              Shopping: 400,
              Accommodations: 800,
              Activities: 250,
              Miscellaneous: 150
            },
            Tien: {
              Food: 500,
              Transportation: 300,
              Shopping: 400,
              Accommodations: 800,
              Activities: 250,
              Miscellaneous: 150
            }
          };
        } catch (error) {
          console.error('Error loading budgets from localStorage:', error);
          return {
            Dan: {
              Food: 500,
              Transportation: 300,
              Shopping: 400,
              Accommodations: 800,
              Activities: 250,
              Miscellaneous: 150
            },
            Tien: {
              Food: 500,
              Transportation: 300,
              Shopping: 400,
              Accommodations: 800,
              Activities: 250,
              Miscellaneous: 150
            }
          };
        }
      });

      const [exchangeRate, setExchangeRate] = useState(() => {
        try {
          const savedRate = localStorage.getItem('travelBudgetExchangeRate');
          return savedRate ? parseFloat(savedRate) : 1.17;
        } catch (error) {
          console.error('Error loading exchange rate from localStorage:', error);
          return 1.17;
        }
      });
      const [showAddForm, setShowAddForm] = useState(false);
      const [showBudgetEdit, setShowBudgetEdit] = useState(false);
      const [editingId, setEditingId] = useState(null);
      const [activePerson, setActivePerson] = useState('Dan');
      const [activeTab, setActiveTab] = useState('categories'); // 'categories' or 'summary'
      const fileInputRef = useRef(null);
      
      const [formData, setFormData] = useState({
        memo: '',
        category: 'Food',
        amount: '',
        date: new Date().toISOString().slice(0, 16),
        payer: 'Dan'
      });

      const categories = ['Food', 'Transportation', 'Shopping', 'Accommodations', 'Activities', 'Miscellaneous'];

      // Save data to localStorage whenever state changes
      useEffect(() => {
        try {
          localStorage.setItem('travelBudgetExpenses', JSON.stringify(expenses));
        } catch (error) {
          console.error('Error saving expenses to localStorage:', error);
        }
      }, [expenses]);

      useEffect(() => {
        try {
          localStorage.setItem('travelBudgetBudgets', JSON.stringify(budgets));
        } catch (error) {
          console.error('Error saving budgets to localStorage:', error);
        }
      }, [budgets]);

      useEffect(() => {
        try {
          localStorage.setItem('travelBudgetExchangeRate', exchangeRate.toString());
        } catch (error) {
          console.error('Error saving exchange rate to localStorage:', error);
        }
      }, [exchangeRate]);

      // Simulate fetching exchange rate (in real app, you'd fetch from an API)
      useEffect(() => {
        // Using the current EUR to USD rate
        setExchangeRate(1.17);
      }, []);

      const resetForm = () => {
        setFormData({
          memo: '',
          category: 'Food',
          amount: '',
          date: new Date().toISOString().slice(0, 16),
          payer: 'Dan'
        });
        setShowAddForm(false);
        setEditingId(null);
      };

      const handleSubmit = (e) => {
        e.preventDefault();
        if (!formData.memo || !formData.amount) return;

        const amount = parseFloat(formData.amount);
        const expense = {
          id: editingId || Date.now(),
          memo: formData.memo,
          category: formData.category,
          amount: amount,
          date: formData.date,
          payer: formData.payer,
          usdAmount: amount * exchangeRate,
          // Calculate individual amounts based on payer
          danAmount: formData.payer === 'Split' ? amount / 2 : (formData.payer === 'Dan' ? amount : 0),
          tienAmount: formData.payer === 'Split' ? amount / 2 : (formData.payer === 'Tien' ? amount : 0)
        };

        if (editingId) {
          setExpenses(expenses.map(exp => exp.id === editingId ? expense : exp));
        } else {
          setExpenses([...expenses, expense]);
        }
        
        resetForm();
      };

      const deleteExpense = (id) => {
        setExpenses(expenses.filter(exp => exp.id !== id));
      };

      const editExpense = (expense) => {
        setFormData({
          memo: expense.memo,
          category: expense.category,
          amount: expense.amount.toString(),
          date: expense.date,
          payer: expense.payer
        });
        setEditingId(expense.id);
        setShowAddForm(true);
      };

      const getCategorySpending = (category, person) => {
        return expenses
          .filter(exp => exp.category === category)
          .reduce((sum, exp) => {
            if (person === 'Dan') return sum + exp.danAmount;
            if (person === 'Tien') return sum + exp.tienAmount;
            return sum + exp.amount; // Total
          }, 0);
      };

      const getTotalSpending = (person) => {
        return expenses.reduce((sum, exp) => {
          if (person === 'Dan') return sum + exp.danAmount;
          if (person === 'Tien') return sum + exp.tienAmount;
          return sum + exp.amount; // Total
        }, 0);
      };

      const getTotalBudget = (person) => {
        if (person === 'Dan' || person === 'Tien') {
          return Object.values(budgets[person]).reduce((a, b) => a + b, 0);
        }
        return Object.values(budgets.Dan).reduce((a, b) => a + b, 0) + Object.values(budgets.Tien).reduce((a, b) => a + b, 0);
      };

      const updateBudget = (person, category, value) => {
        setBudgets(prev => ({
          ...prev,
          [person]: {
            ...prev[person],
            [category]: parseFloat(value) || 0
          }
        }));
      };

      // Clear all data function for testing/reset
      const clearAllData = () => {
        if (window.confirm('Are you sure you want to clear all data? This cannot be undone.')) {
          try {
            localStorage.removeItem('travelBudgetExpenses');
            localStorage.removeItem('travelBudgetBudgets');
            localStorage.removeItem('travelBudgetExchangeRate');
            // Reset to initial state
            setExpenses([]);
            setBudgets({
              Dan: {
                Food: 500,
                Transportation: 300,
                Shopping: 400,
                Accommodations: 800,
                Activities: 250,
                Miscellaneous: 150
              },
              Tien: {
                Food: 500,
                Transportation: 300,
                Shopping: 400,
                Accommodations: 800,
                Activities: 250,
                Miscellaneous: 150
              }
            });
            setExchangeRate(1.17);
          } catch (error) {
            console.error('Error clearing data:', error);
          }
        }
      };

      // Export data to CSV
      const exportToCSV = () => {
        try {
          // Create CSV content for expenses
          const csvHeader = 'Date,Description,Category,Amount (EUR),Amount (USD),Payer,Dan Amount (EUR),Tien Amount (EUR)\n';
          const csvRows = expenses.map(expense => {
            const date = new Date(expense.date).toLocaleString();
            return `"${date}","${expense.memo.replace(/"/g, '""')}","${expense.category}",${expense.amount},${expense.usdAmount.toFixed(2)},"${expense.payer}",${expense.danAmount.toFixed(2)},${expense.tienAmount.toFixed(2)}`;
          }).join('\n');
          
          const csvContent = csvHeader + csvRows;
          
          // Create and trigger download
          const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
          const link = document.createElement('a');
          if (link.download !== undefined) {
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `travel-budget-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          }
        } catch (error) {
          console.error('Error exporting CSV:', error);
          alert('Error exporting data. Please try again.');
        }
      };

      // Import data from CSV
      const importFromCSV = (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const csv = e.target.result;
            const lines = csv.split('\n');
            
            if (lines.length < 2) {
              alert('CSV file appears to be empty or invalid.');
              return;
            }

            // Skip header row and parse data
            const importedExpenses = [];
            for (let i = 1; i < lines.length; i++) {
              const line = lines[i].trim();
              if (!line) continue;
              
              // Parse CSV line (handling quoted strings)
              const values = [];
              let current = '';
              let inQuotes = false;
              
              for (let j = 0; j < line.length; j++) {
                const char = line[j];
                if (char === '"') {
                  if (inQuotes && line[j + 1] === '"') {
                    current += '"';
                    j++; // Skip next quote
                  } else {
                    inQuotes = !inQuotes;
                  }
                } else if (char === ',' && !inQuotes) {
                  values.push(current);
                  current = '';
                } else {
                  current += char;
                }
              }
              values.push(current); // Add last value
              
              if (values.length >= 8) {
                const expense = {
                  id: Date.now() + i, // Generate unique ID
                  date: new Date(values[0]).toISOString().slice(0, 16),
                  memo: values[1],
                  category: values[2],
                  amount: parseFloat(values[3]) || 0,
                  usdAmount: parseFloat(values[4]) || 0,
                  payer: values[5],
                  danAmount: parseFloat(values[6]) || 0,
                  tienAmount: parseFloat(values[7]) || 0
                };
                importedExpenses.push(expense);
              }
            }

            if (importedExpenses.length > 0) {
              if (window.confirm(`Import ${importedExpenses.length} expenses? This will replace your current data.`)) {
                setExpenses(importedExpenses);
                alert(`Successfully imported ${importedExpenses.length} expenses!`);
              }
            } else {
              alert('No valid expense data found in the CSV file.');
            }
          } catch (error) {
            console.error('Error importing CSV:', error);
            alert('Error importing CSV file. Please check the file format and try again.');
          }
        };
        
        reader.readAsText(file);
        // Reset file input
        event.target.value = '';
      };

      // Trigger file input
      const triggerFileInput = () => {
        fileInputRef.current?.click();
      };

      const getProgressColor = (spent, budget) => {
        const percentage = (spent / budget) * 100;
        if (percentage >= 90) return 'bg-red-500';
        if (percentage >= 75) return 'bg-yellow-500';
        return 'bg-green-500';
      };

      return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4" },
        React.createElement('div', { className: "max-w-4xl mx-auto" },
          // Header
          React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6 mb-6" },
            React.createElement('div', { className: "flex items-center justify-between" },
              React.createElement('div', { className: "flex items-center space-x-3" },
                React.createElement(MapPin, { className: "h-8 w-8 text-indigo-600" }),
                React.createElement('div', null,
                  React.createElement('h1', { className: "text-3xl font-bold text-gray-900" }, "Travel Budget Tracker"),
                  React.createElement('p', { className: "text-gray-600" }, "Portugal & France Adventure - Dan & Tien")
                )
              ),
              React.createElement('div', { className: "text-right" },
                React.createElement('div', { className: "text-sm text-gray-500" }, "Exchange Rate"),
                React.createElement('div', { className: "text-lg font-semibold" }, `1 EUR = $${exchangeRate.toFixed(2)} USD`)
              )
            ),
            
            // Person Toggle
            React.createElement('div', { className: "mt-4 flex justify-center" },
              React.createElement('div', { className: "bg-gray-100 rounded-lg p-1 flex" },
                ['Dan', 'Tien', 'Combined'].map(person =>
                  React.createElement('button', {
                    key: person,
                    onClick: () => setActivePerson(person),
                    className: `px-4 py-2 rounded-md transition-colors ${
                      activePerson === person
                        ? 'bg-indigo-600 text-white'
                        : 'text-gray-600 hover:text-gray-900'
                    }`
                  }, person)
                )
              )
            )
          ),

          // Add Expense Button
          React.createElement('div', { className: "mb-6 flex flex-wrap gap-3 items-center justify-between" },
            React.createElement('button', {
              onClick: () => setShowAddForm(true),
              className: "bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors"
            },
              React.createElement(PlusCircle, { className: "h-5 w-5" }),
              React.createElement('span', null, "Add Expense")
            ),
            
            React.createElement('div', { className: "flex flex-wrap gap-2" },
              // Export CSV Button
              React.createElement('button', {
                onClick: exportToCSV,
                className: "bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 text-sm transition-colors"
              },
                React.createElement(Download, { className: "h-4 w-4" }),
                React.createElement('span', null, "Export CSV")
              ),
              
              // Import CSV Button
              React.createElement('button', {
                onClick: triggerFileInput,
                className: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 text-sm transition-colors"
              },
                React.createElement(Upload, { className: "h-4 w-4" }),
                React.createElement('span', null, "Import CSV")
              ),
              
              // Hidden file input
              React.createElement('input', {
                ref: fileInputRef,
                type: "file",
                accept: ".csv",
                onChange: importFromCSV,
                style: { display: 'none' }
              }),
              
              // Clear Data Button
              React.createElement('button', {
                onClick: clearAllData,
                className: "bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm transition-colors"
              }, "Clear All Data")
            )
          ),

          // Add/Edit Expense Form
          showAddForm && React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6 mb-6" },
            React.createElement('h2', { className: "text-xl font-semibold mb-4" }, editingId ? 'Edit Expense' : 'Add New Expense'),
            React.createElement('div', { className: "space-y-4" },
              React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                React.createElement('div', null,
                  React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Description"),
                  React.createElement('input', {
                    type: "text",
                    value: formData.memo,
                    onChange: (e) => setFormData({...formData, memo: e.target.value}),
                    className: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",
                    placeholder: "e.g., Dinner at local restaurant",
                    required: true
                  })
                ),
                React.createElement('div', null,
                  React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Category"),
                  React.createElement('select', {
                    value: formData.category,
                    onChange: (e) => setFormData({...formData, category: e.target.value}),
                    className: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  },
                    categories.map(cat =>
                      React.createElement('option', { key: cat, value: cat }, cat)
                    )
                  )
                ),
                React.createElement('div', null,
                  React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Who's paying?"),
                  React.createElement('select', {
                    value: formData.payer,
                    onChange: (e) => setFormData({...formData, payer: e.target.value}),
                    className: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  },
                    React.createElement('option', { value: "Dan" }, "Dan"),
                    React.createElement('option', { value: "Tien" }, "Tien"),
                    React.createElement('option', { value: "Split" }, "Split (50/50)")
                  )
                ),
                React.createElement('div', null,
                  React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Amount (EUR)"),
                  React.createElement('input', {
                    type: "number",
                    step: "0.01",
                    value: formData.amount,
                    onChange: (e) => setFormData({...formData, amount: e.target.value}),
                    className: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",
                    placeholder: "0.00",
                    required: true
                  }),
                  formData.amount && React.createElement('div', { className: "text-sm text-gray-500 mt-1" },
                    React.createElement('p', null, `≈ $${(parseFloat(formData.amount || 0) * exchangeRate).toFixed(2)} USD`),
                    formData.payer === 'Split' && React.createElement('p', null, `€${(parseFloat(formData.amount || 0) / 2).toFixed(2)} each`)
                  )
                ),
                React.createElement('div', null,
                  React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Date & Time"),
                  React.createElement('input', {
                    type: "datetime-local",
                    value: formData.date,
                    onChange: (e) => setFormData({...formData, date: e.target.value}),
                    className: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  })
                )
              ),
              React.createElement('div', { className: "flex space-x-3" },
                React.createElement('button', {
                  type: "button",
                  onClick: (e) => {
                    e.preventDefault();
                    handleSubmit(e);
                  },
                  className: "bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md transition-colors"
                }, editingId ? 'Update Expense' : 'Add Expense'),
                React.createElement('button', {
                  type: "button",
                  onClick: resetForm,
                  className: "bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-md transition-colors"
                }, "Cancel")
              )
            )
          ),

          // Tab Navigation
          React.createElement('div', { className: "mb-6" },
            React.createElement('div', { className: "border-b border-gray-200" },
              React.createElement('nav', { className: "-mb-px flex space-x-8" },
                React.createElement('button', {
                  onClick: () => setActiveTab('categories'),
                  className: `py-2 px-1 border-b-2 font-medium text-sm transition-colors ${
                    activeTab === 'categories'
                      ? 'border-indigo-500 text-indigo-600'
                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                  }`
                }, "Category Dashboard"),
                React.createElement('button', {
                  onClick: () => setActiveTab('summary'),
                  className: `py-2 px-1 border-b-2 font-medium text-sm transition-colors ${
                    activeTab === 'summary'
                      ? 'border-indigo-500 text-indigo-600'
                      : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                  }`
                }, "Summary Overview")
              )
            )
          ),

          // Tab Content
          activeTab === 'summary' && React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-6 mb-6" },
            React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6" },
              React.createElement('div', { className: "flex items-center justify-between" },
                React.createElement('div', null,
                  React.createElement('p', { className: "text-sm text-gray-500" },
                    activePerson === 'Combined' ? 'Total Spent' : `${activePerson}'s Spending`
                  ),
                  React.createElement('p', { className: "text-2xl font-bold text-gray-900" }, `€${getTotalSpending(activePerson === 'Combined' ? null : activePerson).toFixed(2)}`),
                  React.createElement('p', { className: "text-sm text-gray-600" }, `$${(getTotalSpending(activePerson === 'Combined' ? null : activePerson) * exchangeRate).toFixed(2)} USD`)
                ),
                React.createElement(Euro, { className: "h-8 w-8 text-indigo-600" })
              )
            ),
            
            React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6" },
              React.createElement('div', { className: "flex items-center justify-between" },
                React.createElement('div', null,
                  React.createElement('p', { className: "text-sm text-gray-500" },
                    activePerson === 'Combined' ? 'Total Budget' : `${activePerson}'s Budget`
                  ),
                  React.createElement('p', { className: "text-2xl font-bold text-gray-900" }, `€${getTotalBudget(activePerson === 'Combined' ? null : activePerson)}`),
                  React.createElement('p', { className: "text-sm text-gray-600" }, `$${(getTotalBudget(activePerson === 'Combined' ? null : activePerson) * exchangeRate).toFixed(2)} USD`)
                ),
                React.createElement(DollarSign, { className: "h-8 w-8 text-green-600" })
              )
            ),

            React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6" },
              React.createElement('div', { className: "flex items-center justify-between" },
                React.createElement('div', null,
                  React.createElement('p', { className: "text-sm text-gray-500" }, "Remaining"),
                  React.createElement('p', { className: "text-2xl font-bold text-gray-900" }, `€${(getTotalBudget(activePerson === 'Combined' ? null : activePerson) - getTotalSpending(activePerson === 'Combined' ? null : activePerson)).toFixed(2)}`),
                  React.createElement('p', { className: "text-sm text-gray-600" }, `$${((getTotalBudget(activePerson === 'Combined' ? null : activePerson) - getTotalSpending(activePerson === 'Combined' ? null : activePerson)) * exchangeRate).toFixed(2)} USD`)
                ),
                React.createElement('div', { className: "h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center" },
                  React.createElement('span', { className: "text-blue-600 font-bold" }, "€")
                )
              )
            )
          ),

          // Budget Categories Dashboard
          activeTab === 'categories' && React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6" },
            categories.map(category => {
              let spent, budget;
              
              if (activePerson === 'Combined') {
                spent = getCategorySpending(category, 'Dan') + getCategorySpending(category, 'Tien');
                budget = budgets.Dan[category] + budgets.Tien[category];
              } else {
                spent = getCategorySpending(category, activePerson);
                budget = budgets[activePerson][category];
              }
              
              const percentage = (spent / budget) * 100;
              
              return React.createElement('div', { key: category, className: "bg-white rounded-lg shadow-lg p-6" },
                React.createElement('div', { className: "flex justify-between items-center mb-3" },
                  React.createElement('h3', { className: "text-lg font-semibold text-gray-900" }, category),
                  React.createElement('div', { className: "text-right" },
                    React.createElement('p', { className: "text-sm text-gray-500" }, `€${spent.toFixed(2)} / €${budget}`),
                    React.createElement('p', { className: "text-xs text-gray-400" }, `$${(spent * exchangeRate).toFixed(2)} USD`),
                    activePerson === 'Combined' && React.createElement('div', { className: "text-xs text-gray-400 mt-1" },
                      React.createElement('div', null, `Dan: €${getCategorySpending(category, 'Dan').toFixed(2)}`),
                      React.createElement('div', null, `Tien
```
