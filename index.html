<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Budget Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center py-6">
    <div id="root"></div>

<script>
const { useState, useEffect, useRef, createElement } = React;

const PlusCircle = (props) => createElement(
    'svg',
    {
        ...props,
        fill: 'none',
        stroke: 'currentColor',
        viewBox: '0 0 24 24',
        xmlns: 'http://www.w3.org/2000/svg',
        width: 24,
        height: 24
    },
    createElement('circle', { cx: '12', cy: '12', r: '10' }),
    createElement('path', { d: 'M12 8v8m-4-4h8' })
);

const Trash2 = (props) => createElement(
    'svg',
    {
        ...props,
        fill: 'none',
        stroke: 'currentColor',
        viewBox: '0 0 24 24',
        xmlns: 'http://www.w3.org/2000/svg',
        width: 20,
        height: 20
    },
    createElement('polyline', { points: '3 6 5 6 21 6' }),
    createElement('path', { d: 'M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M10 11v6M14 11v6M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2' })
);

function TravelBudgetTracker() {
    const [expenses, setExpenses] = useState(() => {
        try {
            const data = localStorage.getItem('expenses');
            return data ? JSON.parse(data) : [];
        } catch {
            return [];
        }
    });

    useEffect(() => {
        localStorage.setItem('expenses', JSON.stringify(expenses));
    }, [expenses]);

    const [form, setForm] = useState({
        memo: '', category: '', amount: '', date: '', payer: ''
    });

    function handleInput(e) {
        setForm({ ...form, [e.target.name]: e.target.value });
    }

    function handleAddExpense(e) {
        e.preventDefault();
        if (!form.memo || !form.amount || !form.date) return;
        setExpenses([
            ...expenses,
            {
                id: Date.now() + Math.random(),
                memo: form.memo,
                category: form.category,
                amount: parseFloat(form.amount) || 0,
                date: form.date,
                payer: form.payer,
            }
        ]);
        setForm({ memo: '', category: '', amount: '', date: '', payer: '' });
    }

    function handleDelete(id) {
        setExpenses(expenses.filter(exp => exp.id !== id));
    }

    // ----------- CSV Export Logic -----------
    function arrayToCSV(data) {
        if (!data.length) return '';
        const headers = Object.keys(data[0]);
        const csvRows = [
            headers.join(','),
            ...data.map(row => headers.map(
                field => JSON.stringify(row[field] ?? '')
            ).join(','))
        ];
        return csvRows.join('\n');
    }

    function handleExportCSV() {
        const csv = arrayToCSV(expenses);
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = 'expenses.csv';
        a.click();
        URL.revokeObjectURL(url);
    }
    // -----------------------------------------

    // UI (all React.createElement style, NO JSX)
    return createElement('div', { className: "w-full max-w-2xl bg-white p-6 rounded-2xl shadow-xl" },
        // Header with Export CSV button
        createElement('div', { className: "flex items-center justify-between mb-4" },
            createElement('h1', { className: "text-2xl font-bold text-gray-900" }, "Travel Budget Tracker"),
            createElement('div', null,
                createElement('button', {
                    className: "ml-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition",
                    onClick: handleExportCSV,
                    title: "Export to CSV"
                }, "Export CSV")
            )
        ),
        // Form to add expenses
        createElement('form', {
            onSubmit: handleAddExpense,
            className: "grid grid-cols-1 md:grid-cols-6 gap-2 mb-6"
        },
            createElement('input', {
                name: "memo",
                className: "col-span-2 border rounded p-2",
                placeholder: "Description",
                value: form.memo,
                onChange: handleInput,
                required: true
            }),
            createElement('input', {
                name: "category",
                className: "col-span-1 border rounded p-2",
                placeholder: "Category",
                value: form.category,
                onChange: handleInput
            }),
            createElement('input', {
                name: "amount",
                className: "col-span-1 border rounded p-2",
                placeholder: "Amount (EUR)",
                type: "number",
                min: "0",
                step: "0.01",
                value: form.amount,
                onChange: handleInput,
                required: true
            }),
            createElement('input', {
                name: "date",
                className: "col-span-1 border rounded p-2",
                placeholder: "Date",
                type: "datetime-local",
                value: form.date,
                onChange: handleInput,
                required: true
            }),
            createElement('input', {
                name: "payer",
                className: "col-span-1 border rounded p-2",
                placeholder: "Payer",
                value: form.payer,
                onChange: handleInput
            }),
            createElement('button', {
                className: "col-span-1 mt-1 md:mt-0 bg-green-500 text-white rounded px-4 py-2 hover:bg-green-600 transition flex items-center justify-center",
                type: "submit",
                title: "Add Expense"
            },
                createElement(PlusCircle, { className: "w-5 h-5 inline mr-1" }),
                "Add"
            )
        ),
        // Expenses Table
        createElement('div', { className: "overflow-x-auto" },
            createElement('table', { className: "w-full table-auto border-collapse" },
                createElement('thead', null,
                    createElement('tr', { className: "bg-gray-100" },
                        createElement('th', { className: "py-2 px-2 text-left text-xs text-gray-600" }, "Description"),
                        createElement('th', { className: "py-2 px-2 text-left text-xs text-gray-600" }, "Category"),
                        createElement('th', { className: "py-2 px-2 text-left text-xs text-gray-600" }, "Amount (EUR)"),
                        createElement('th', { className: "py-2 px-2 text-left text-xs text-gray-600" }, "Date"),
                        createElement('th', { className: "py-2 px-2 text-left text-xs text-gray-600" }, "Payer"),
                        createElement('th', { className: "py-2 px-2" }, "")
                    )
                ),
                createElement('tbody', null,
                    expenses.length === 0 ?
                        createElement('tr', null,
                            createElement('td', {
                                colSpan: 6,
                                className: "text-center text-gray-400 py-6"
                            }, "No expenses yet.")
                        )
                        :
                        expenses.map(function (exp) {
                            return createElement('tr', { key: exp.id, className: "border-b last:border-none" },
                                createElement('td', { className: "py-2 px-2" }, exp.memo),
                                createElement('td', { className: "py-2 px-2" }, exp.category),
                                createElement('td', { className: "py-2 px-2" }, exp.amount.toFixed(2)),
                                createElement('td', { className: "py-2 px-2" }, exp.date.replace('T', ' ')),
                                createElement('td', { className: "py-2 px-2" }, exp.payer),
                                createElement('td', { className: "py-2 px-2" },
                                    createElement('button', {
                                        className: "text-red-500 hover:text-red-700",
                                        onClick: function () { handleDelete(exp.id); },
                                        title: "Delete"
                                    }, createElement(Trash2, { className: "inline" }))
                                )
                            );
                        })
                )
            )
        )
    );
}

// Mount with React 18
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(createElement(TravelBudgetTracker));
</script>
</body>
</html>
