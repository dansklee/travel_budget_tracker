<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Budget Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <div id="root"></div>

<script>
const { useState } = React;

// Create icon components
const PlusCircle = (props) => React.createElement('svg', {
    ...props,
    fill: 'none',
    stroke: 'currentColor',
    viewBox: '0 0 24 24',
    xmlns: 'http://www.w3.org/2000/svg',
    width: 24,
    height: 24
},
    React.createElement('circle', { cx: '12', cy: '12', r: '10' }),
    React.createElement('path', { d: 'M12 8v8m-4-4h8' })
);

const Trash2 = (props) => React.createElement('svg', {
    ...props,
    fill: 'none',
    stroke: 'currentColor',
    viewBox: '0 0 24 24',
    xmlns: 'http://www.w3.org/2000/svg',
    width: 20,
    height: 20
},
    React.createElement('polyline', { points: '3 6 5 6 21 6' }),
    React.createElement('path', { d: 'M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M10 11v6M14 11v6M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2' })
);

function TravelBudgetTracker() {
    const [expenses, setExpenses] = useState(() => {
        try {
            const data = localStorage.getItem('expenses');
            return data ? JSON.parse(data) : [];
        } catch {
            return [];
        }
    });

    const [form, setForm] = useState({
        memo: '', category: '', amount: '', date: '', payer: ''
    });

    function handleInput(e) {
        setForm({ ...form, [e.target.name]: e.target.value });
    }

    function handleAddExpense(e) {
        e.preventDefault();
        if (!form.memo || !form.amount || !form.date) return;
        setExpenses([
            ...expenses,
            {
                id: Date.now() + Math.random(),
                memo: form.memo,
                category: form.category,
                amount: parseFloat(form.amount) || 0,
                date: form.date,
                payer: form.payer,
            }
        ]);
        setForm({ memo: '', category: '', amount: '', date: '', payer: '' });
    }

    function handleDelete(id) {
        setExpenses(expenses.filter(exp => exp.id !== id));
    }

    // ---- CSV EXPORT FUNCTION ----
    function handleExportCSV() {
        if (!expenses.length) return;
        const headers = Object.keys(expenses[0]);
        const csvRows = [
            headers.join(','),
            ...expenses.map(row => headers.map(
                field => JSON.stringify(row[field] ?? '')
            ).join(','))
        ];
        const csv = csvRows.join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'expenses.csv';
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }, 0);
    }
    // ---- END CSV EXPORT FUNCTION ----

    // Persist expenses to localStorage on change
    React.useEffect(() => {
        localStorage.setItem('expenses', JSON.stringify(expenses));
    }, [expenses]);

    return React.createElement('div', { className: "max-w-2xl mx-auto bg-white p-4 rounded-xl shadow mt-8" },
        // Header row with Export CSV button
        React.createElement('div', { className: "flex justify-between items-center mb-6" },
            React.createElement('h1', { className: "text-2xl font-bold" }, "Travel Budget Tracker"),
            React.createElement('button', {
                className: "px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",
                onClick: handleExportCSV,
                title: "Export CSV"
            }, "Export CSV")
        ),
        // Add expense form
        React.createElement('form', { onSubmit: handleAddExpense, className: "grid grid-cols-1 md:grid-cols-6 gap-2 mb-4" },
            React.createElement('input', {
                name: "memo",
                className: "col-span-2 border rounded p-2",
                placeholder: "Description",
                value: form.memo,
                onChange: handleInput,
                required: true
            }),
            React.createElement('input', {
                name: "category",
                className: "col-span-1 border rounded p-2",
                placeholder: "Category",
                value: form.category,
                onChange: handleInput
            }),
            React.createElement('input', {
                name: "amount",
                className: "col-span-1 border rounded p-2",
                placeholder: "Amount (EUR)",
                type: "number",
                min: "0",
                step: "0.01",
                value: form.amount,
                onChange: handleInput,
                required: true
            }),
            React.createElement('input', {
                name: "date",
                className: "col-span-1 border rounded p-2",
                placeholder: "Date",
                type: "datetime-local",
                value: form.date,
                onChange: handleInput,
                required: true
            }),
            React.createElement('input', {
                name: "payer",
                className: "col-span-1 border rounded p-2",
                placeholder: "Payer",
                value: form.payer,
                onChange: handleInput
            }),
            React.createElement('button', {
                className: "col-span-1 bg-green-500 text-white rounded px-4 py-2 flex items-center justify-center hover:bg-green-600",
                type: "submit",
                title: "Add Expense"
            },
                React.createElement(PlusCircle, { className: "w-5 h-5 inline mr-1" }),
                "Add"
            )
        ),
        // Expense table
        React.createElement('div', { className: "overflow-x-auto" },
            React.createElement('table', { className: "w-full table-auto border-collapse" },
                React.createElement('thead', null,
                    React.createElement('tr', { className: "bg-gray-100" },
                        React.createElement('th', { className: "py-2 px-2 text-left text-xs text-gray-600" }, "Description"),
                        React.createElement('th', { className: "py-2 px-2 text-left text-xs text-gray-600" }, "Category"),
                        React.createElement('th', { className: "py-2 px-2 text-left text-xs text-gray-600" }, "Amount (EUR)"),
                        React.createElement('th', { className: "py-2 px-2 text-left text-xs text-gray-600" }, "Date"),
                        React.createElement('th', { className: "py-2 px-2 text-left text-xs text-gray-600" }, "Payer"),
                        React.createElement('th', { className: "py-2 px-2" })
                    )
                ),
                React.createElement('tbody', null,
                    expenses.length === 0 ?
                        React.createElement('tr', null,
                            React.createElement('td', {
                                colSpan: 6,
                                className: "text-center text-gray-400 py-6"
                            }, "No expenses yet.")
                        )
                        :
                        expenses.map(function (exp) {
                            return React.createElement('tr', { key: exp.id, className: "border-b last:border-none" },
                                React.createElement('td', { className: "py-2 px-2" }, exp.memo),
                                React.createElement('td', { className: "py-2 px-2" }, exp.category),
                                React.createElement('td', { className: "py-2 px-2" }, exp.amount.toFixed(2)),
                                React.createElement('td', { className: "py-2 px-2" }, exp.date.replace('T', ' ')),
                                React.createElement('td', { className: "py-2 px-2" }, exp.payer),
                                React.createElement('td', { className: "py-2 px-2" },
                                    React.createElement('button', {
                                        className: "text-red-500 hover:text-red-700",
                                        onClick: function () { handleDelete(exp.id); },
                                        title: "Delete"
                                    }, React.createElement(Trash2, { className: "inline" }))
                                )
                            );
                        })
                )
            )
        )
    );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(React.createElement(TravelBudgetTracker));
</script>
</body>
</html>
